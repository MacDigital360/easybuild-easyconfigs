easyblock = 'Conda'

name = 'WML-CE'
version = '1.6.2'

homepage = 'https://developer.ibm.com/linuxonpower/deep-learning-powerai/#wmlce'
description = """Designed to get you set up and operating as quickly as possible, Watson Machine Learning Community
 Edition (WML CE) is delivered as a set of software packages that can deploy a functioning deep learning environment,
 potentially within hours, and usually in less than one hour with a few simple commands. """

toolchain = SYSTEM

# For WML-CE (gpu) on POWER9: powerai=1.6.2m powerai-rapids=1.6.2m cudatoolkit-dev
# For Ondemand use: ipython nose testpath nbformat ipykernel
requirements = "powerai=%(version)s powerai-rapids=%(version)s cudatoolkit-dev ipython nose testpath nbformat ipykernel"
channels = [
    'https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda/',
    'conda-forge',
]

dependencies = [('Miniconda3', '4.7.10')]

preinstallopts = 'export IBM_POWERAI_LICENSE_ACCEPT=yes && '
installopts = 'python=3.7'

sanity_check_paths = {
    'files': [],
    'dirs': ['lib/python3.7/site-packages/%s' % x for x in ['tensorflow', 'torch', 'snap_ml']],
}

modextravars = {'CONDA_PREFIX': '%(installdir)s'}

moduleclass = 'tools'
